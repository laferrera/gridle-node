<link rel="stylesheet" type="text/css" media="all" href="css/main.css">
</link>

<input type="text" onkeyup="updateGrid(this)"/>
<input id="x" type="number" />
<input id="y" type="number" />
<button onclick="updateGridXY()"> submit </button>

<script>
 let grid = [];
for (let y = 0; y < 8; y++) {
    grid[y] = [];
    for (let x = 0; x < 16; x++) {
        grid[y][x] = 0;
    }
}

function tableCreate() {
    var body = document.getElementsByTagName('body')[0];
    var tbl = document.createElement('table');
    // tbl.style.width = '100%';
    // tbl.setAttribute('border', '1');
    var tbdy = document.createElement('tbody');
    for (var i = 0; i < 8; i++) {
        var tr = document.createElement('tr');
        for (var j = 0; j < 16; j++) {
            var td = document.createElement('td');
            td.appendChild(document.createTextNode('■'))
            // i == 1 && j == 1 ? td.setAttribute('rowSpan', '2') : null;
            tr.appendChild(td)
        }
        tbdy.appendChild(tr);
    }
    tbl.appendChild(tbdy);
    body.appendChild(tbl)
}
tableCreate();

mytablebody = document.getElementsByTagName("tbody")[0];

function clearGrid() {
    Array.from(document.getElementsByTagName("td")).forEach(td => td.innerHTML = " ");
    fetch("/api/grid/clear", { method: "POST", headers: { 'Content-Type': 'application/json' } })
}

function updateGridIndividual(x,y,b) {
    fetch("/api/grid/set_individual", {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ x: x, y: y, b: b })
    }).then(res => {
        console.log("Request complete! response:", res);
    });
}

function updateGridXY() {
    let x = document.getElementById('x').value
    let y = document.getElementById('y').value
    let b = 15
    updateGridIndividual(x,y,b);
}

// function bitmapToGrid(bitmap) {
//     for (let y = 0; y < 8; y++) {
//         for (let x = 0; x < 16; x++) {
//             if (bitmap[y][x] == 1) {
//                 updateGridIndividual(x,y,15);
//             }
//         }
//     }
// }

function sendBitmapToGrid (bitmap) {
    fetch("/api/grid/set_grid", {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ grid: bitmap })
    }).then(res => {
        console.log("Request complete! response:", res);
    });
}

function updateGrid(e) {
    clearGrid();
    let char = e.value;
    bitmap = chars[char].bitmap;
    sendBitmapToGrid(bitmap);
    for (let i = 0; i < bitmap.length; i++) {
        let row = bitmap[i];
        for (let j = 0; j < row.length; j++) {
            myrow = mytablebody.getElementsByTagName("tr")[i];
            mycel = myrow.getElementsByTagName("td")[j];
            let fill = " "
            row[j] > 0 ? fill = "■" : fill = " ";
            mycel.innerHTML = fill;
            // mycel.innerHTML = " ";
            // mycel.innerHTML = "■";
        }
    }
}
</script>

<script src="js/characterOutput.js"></script>